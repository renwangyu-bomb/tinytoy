/*!
 * tinytoy.js v0.0.1 - 无聊的小玩意
 * Copyright (c) 2015 renwangyu
 * License: MIT
 */

function cube(a){for(this.imgSrc=a.imgSrc||[];this.imgSrc.length&&6!==this.imgSrc.length;){if(!(this.imgSrc.length<6)){this.imgSrc.length=6;break}this.imgSrc[this.imgSrc.length]=this.imgSrc[this.imgSrc.length-1]}this.stage=a.stage,this.perspective=a.perspective||1e3,this.imgWh=a.wh||100}function imgclipplay(a){this.imgBox=a.imgBox,this.imgSrc=a.imgSrc||[],1===this.imgSrc.length&&(this.imgSrc[this.imgSrc.length]=this.imgSrc[this.imgSrc.length-1]),this.imgWidth=a.imgWidth||300,this.imgHeight=a.imgHeight||200,this.currIdx=0,this.timer=null,this.interval=a.interval&&a.interval<2e3||2e3,this.radius=2*Math.max(this.imgWidth,this.imgHeight),this.count=this.imgSrc.length}cube.prototype.init=function(){this.create(),this.handleEvent()},cube.prototype.create=function(){if(this.stage){var a=window.tinytoy.tt_util,b=["rotateY(0deg)","rotateY(90deg)","rotateY(180deg)","rotateY(270deg)","rotateX(90deg)","rotateX(270deg)"];a.addClass(this.stage,"tt-stage"),a.addStyle(this.stage,"width",this.imgWh+"px"),a.addStyle(this.stage,"height",this.imgWh+"px"),a.addStyle(this.stage,"perspective",this.perspective+"px");var c=document.createElement("div");a.addClass(c,"tt-img-container"),a.addStyle(c,"width",this.imgWh+"px"),a.addStyle(c,"height",this.imgWh+"px"),this.imgSrc.forEach(function(d,e){var f=document.createElement("img");f.setAttribute("alt","tinytoy's loading img"),f.setAttribute("src",d),a.addStyle(f,"width",this.imgWh+"px"),a.addStyle(f,"height",this.imgWh+"px"),a.addStyle(f,"-webkit-transform",b[e]+" translateZ("+this.imgWh/2+"px)"),c.appendChild(f)}.bind(this)),this.stage.appendChild(c)}},cube.prototype.handleEvent=function(){if(this.stage){var a=this.stage,b=!1,c={x:0,y:0},d=(Math.PI/180,2),e=0,f=0,g=this.stage.children[0];a.addEventListener("mousedown",function(a){b=!0,c.x=a.pageX,c.y=a.pageY},!1),a.addEventListener("mouseup",function(){b=!1},!1),a.addEventListener("mousemove",function(a){if(b){var h={x:a.pageX,y:a.pageY},i=h.x-c.x,j=h.y-c.y;e-=j*d,f+=i*d,g.style.transform="rotateX("+e+"deg) rotateY("+f+"deg)",c.x=h.x,c.y=h.y}},!1)}},imgclipplay.prototype.updateCurrIdx=function(){this.currIdx=this.currIdx+1<this.count?this.currIdx+1:0},imgclipplay.prototype.getNextIdx=function(a){a=a||1;var b=this.currIdx+a;return b<this.count?b:b-this.count},imgclipplay.prototype.init=function(){this.create(),this.play()},imgclipplay.prototype.create=function(){if(this.imgBox){var a=window.tinytoy.tt_util;a.addClass(this.imgBox,"tt-imgclipplay-box"),a.addStyle(this.imgBox,"width",this.imgWidth+"px"),a.addStyle(this.imgBox,"height",this.imgHeight+"px"),this.centerPoint={x:this.imgBox.offsetWidth/2,y:this.imgBox.offsetHeight/2},this.imgSrc.forEach(function(b,c){var d=document.createElement("img");d.setAttribute("alt","tinytoy's loading img"+c),d.setAttribute("src",b),d.setAttribute("tt-index",c),d.setAttribute("class",""),a.addStyle(d,"width",this.imgWidth+"px"),a.addStyle(d,"height",this.imgHeight+"px"),0===c?(a.addClass(d,"curr"),d.style.cssText+="-webkit-clip-path: circle("+this.radius+"px at "+this.centerPoint.x+"px "+this.centerPoint.y+"px)"):d.style.cssText+="-webkit-clip-path: circle(0px at "+this.centerPoint.x+"px "+this.centerPoint.y+"px)",this.imgBox.appendChild(d)}.bind(this))}},imgclipplay.prototype.play=function(){if(this.imgSrc.length){var a=window.tinytoy.tt_util,b=new RegExp(this.radius+"px at","g");this.timer=setTimeout(function(){var c=document.querySelector("img[tt-index='"+this.currIdx+"']"),d=document.querySelector("img[tt-index='"+this.getNextIdx(1)+"']");c.style.cssText=c.style.cssText.replace(b,"0px at"),setTimeout(function(c,d,e,f){return function(){a.addClass(d,"curr"),a.removeClass(c,"curr"),setTimeout(function(){return function(){d.style.cssText=d.style.cssText.replace(b,"0px at"),d.style.cssText=d.style.cssText.replace(/0px at/g,e+"px at")}}(c),200),f()}}(c,d,this.radius,this.updateCurrIdx.bind(this)),1e3),this.timer=setTimeout(arguments.callee.bind(this),this.interval)}.bind(this),this.interval)}},function(){window.tinytoy||(window.tinytoy={tt_util:{addClass:function(a,b){a.classList?a.classList.add(b):~a.className.indexOf(b)||(a.className+=b)},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp(b,"g"),"")},addStyle:function(a,b,c){a.style[b]=c}},tt_cube:function(a){var b=new cube(a);b.init()},tt_imgclipplay:function(a){var b=new imgclipplay(a);b.init()}})}();